# The Belongs relatiobnship and saving graph of objects
I am trying to detrmine how should relationship work when saving a graph of object in  rails/ How should the UI be? How should paper trail work and optimistic concurrency control work using stale saves. 

## The Belongs To Relationship and Saving Graph of Objects - Simple object like address belonging to a Customer
  Fundamentally there is a belongs relationship. Customer and many addresses that belong to a customer. When I Create a customer draft flow. I think i should noy show addresses table. later when a suctomer is saved one can add adrdesses by clicking add on top of address table. The save of the address should be immediate not to be included in the main customer parent save as user may have changed the customer fields as well. So I am thinking clicking add opens a doalog dave address then adds a row on the address table in customer page. with message address saved. But the customer page may still be dirty and owuld need save or  dialog with warning, thay there are unsaved changes should you want to naviagte away.

## The Belongs To Relationship and Saving Graph of Objects - Complex object like order with line items
From a customer page just like address table there is an orders table. But this in case Orders is a complex object with line items. So clicking add on orders table should open a new page in spereate browser tab with order form and line items table. Clicking save on order page should save the order and line items and return to customer page with new order row added to orders table. The customer page may still be dirty and owuld need save or  dialog with warning, thay there are unsaved changes should you want to naviagte away.  Orders is a complex object graph with line items belonging to order. So the order page should have a line items table with add button on top of it. Clicking add should open a dialog to add line item and save it immediately. The order deserves a table just like customer table on its own. The orders being the many side then should also allow order creation from orders page which will requires selecrting a customer which is one side of a relartionship.


## The Many to Many Relationship and Saving Graph of Objects - Complex object like product with categories
In M:M case both sides are independent objects. so they deserve a main table like customers and orders. So people can create Product and Category from their own main pages. I think we can simplify the UI by showing the link instead of add button on top of categories table in product page. Clicking link should open a dialog with list of categories with checkboxes to select and link to product. Clicking save on dialog should save the links immediately and return to product page with categories table updated. The product page may still be dirty and owuld need save or  dialog with warning, thay there are unsaved changes should you want to naviagte away.  Similarly clicking link on top of products table in category page should open a dialog with list of products with checkboxes to select and link to category. Clicking save on dialog should save the links immediately and return to category page with products table updated. The category page may still be dirty and owuld need save or  dialog with warning, thay there are unsaved changes should you want to naviagte away.   This way we do not have the "add" complexity of creating product or category from the other side.

## The Paper Trail and Optimistic Concurrency Control
Paper trail should work as expected. Each save should create a new version. The stale object save should be detected and user should be warned and given option to reload the page with latest data or overwrite the changes.  The stale object save should be detected at each level. So if customer is stale then user should be warned when saving customer. If address is stale then user should be warned when saving address. If order is stale then user should be warned when saving order. If line item is stale then user should be warned when saving line item. If product is stale then user should be warned when saving product. If category is stale then user should be warned when saving category.  I assume the paper trail should be then able to show me the entire history of changes to the parent object in a time line view. So I can see the changes to customer and its addresses and orders and their line items in a single timeline view. Similarly I can see the changes to product and its categories in a single timeline view. The timeline should show show only level 1 associations for example customers change history would include only orders and address chanegs not order line items changes. The order change history would include only line items changes. The product change history would include only categories changes. The category change history would include only products changes.  I think this is how it should work. Please correct me if I am wrong.


