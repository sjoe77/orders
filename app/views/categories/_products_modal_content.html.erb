<turbo-frame id="category_products_modal"
            data-controller="many-to-many"
            data-many-to-many-relationship-type-value="products"
            data-many-to-many-link-action-path-value="<%= link_products_category_path(@category) %>"
            data-many-to-many-frame-id-value="category_products">

  <!-- Search and Filter Controls -->
  <div class="row mb-3">
    <div class="col-md-6">
      <input type="text"
             class="form-control"
             placeholder="Search products..."
             data-many-to-many-target="searchInput">
    </div>
    <div class="col-md-6 text-end">
      <button type="button"
              class="btn btn-outline-secondary me-2"
              data-action="click->many-to-many#selectAll">
        Select All
      </button>
      <button type="button"
              class="btn btn-outline-secondary"
              data-action="click->many-to-many#clearAll">
        Clear All
      </button>
    </div>
  </div>

  <!-- Available Products Table -->
  <div class="border rounded" data-many-to-many-target="itemsList">
    <%= render TableComponent.new(
      collection: Paginatable::PaginationResult.new(
        relation: @available_products,
        page: (params[:page] || 1).to_i,
        per_page: 10
      ),
      config: @modal_table_config,
      current_params: params.permit!,
      show_checkboxes: true,
      checkbox_options: {
        target: "itemCheckbox",
        name: "selected_items[]",
        checked_items: @current_product_ids,
        value_field: :id
      }
    ) %>
  </div>

  <!-- Summary -->
  <div class="mt-3 p-2 bg-light rounded">
    <small class="text-muted">
      <span data-many-to-many-target="selectedCount">0</span> products selected
    </small>
  </div>

  <!-- Save Button -->
  <div class="mt-3 text-end">
    <button type="button"
            class="btn btn-primary"
            data-action="click->many-to-many#saveChanges"
            data-many-to-many-target="saveButton">
      Save Changes
    </button>
  </div>

</turbo-frame>