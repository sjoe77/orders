<%= render FormComponent.new(model: customer, url: customer.persisted? ? customer_path(customer) : customers_path, method: customer.persisted? ? :patch : :post, html: { id: "customer_form" }) do |form| %>
  <% if customer.errors.any? %>
    <div class="col-12">
      <div class="alert alert-danger py-2" role="alert">
        <h6 class="alert-heading mb-1"><%= pluralize(customer.errors.count, "error") %> prohibited this customer from being saved:</h6>
        <ul class="mb-0 small">
          <% customer.errors.each do |error| %>
            <li><%= error.full_message %></li>
          <% end %>
        </ul>
      </div>
    </div>
  <% end %>

  <div class="col-12">
    <%= render TabsComponent.new(id: "customer_tabs") do |tabs| %>
      <% tabs.with_tab(title: t('customers.basic_information'), active: true) do %>
        <div class="row g-2 pt-2">
          <div class="col-6">
            <%= form.input_field :customer_key_nm,
                                    label: t('attributes.customer.customer_key_nm'),
                                    required: true %>
          </div>
          <div class="col-6">
            <% if customer.persisted? %>
              <label class="form-label small mb-1"><%= t('attributes.customer.customer_num') %></label>
              <div class="form-control form-control-sm bg-light" style="color: #6c757d;"><%= customer.customer_num %></div>
            <% else %>
              <%= form.input_field :customer_num,
                                  label: t('attributes.customer.customer_num'),
                                  help_text: "Auto-generated if left blank" %>
            <% end %>
          </div>
          <div class="col-12">
            <%= form.input_field :company_name_nm,
                                label: t('attributes.customer.company_name_nm'),
                                required: true %>
          </div>
          <div class="col-6">
            <%= form.input_field :contact_first_name_nm,
                                label: t('attributes.customer.contact_first_name_nm') %>
          </div>
          <div class="col-6">
            <%= form.input_field :contact_last_name_nm,
                                label: t('attributes.customer.contact_last_name_nm') %>
          </div>
          <div class="col-6">
            <%= form.email_input :email_nm,
                                 label: t('attributes.customer.email_nm') %>
          </div>
          <div class="col-6">
            <%= form.phone_input :phone_num,
                                     label: t('attributes.customer.phone_num') %>
          </div>
          <div class="col-6">
            <%= form.number_input :credit_limit_amt,
                              label: t('attributes.customer.credit_limit_amt'),
                              step: :any,
                              min: 0 %>
          </div>
          <div class="col-6">
            <%= form.checkbox_input :active_flag,
                          label: t('attributes.customer.active_flag') %>
          </div>
        </div>
      <% end %>

      <% tabs.with_tab(title: "Additional Information") do %>
        <div class="row g-2 pt-2">
          <div class="col-6">
            <%= form.input_field :tax_id_num,
                                label: "Tax ID" %>
          </div>
        </div>
      <% end %>
    <% end %>
  </div>

  <!-- Graph Form Hidden Fields -->
  <%= form.hidden_input :pending_changes,
                        data: {
                          "graph-form-target": "pendingChanges"
                        } %>
  <%= form.hidden_input :lock_version if customer.persisted? %>

  <!-- JSON-based patch container (no individual hidden fields needed) -->
  <div id="addresses_nested_attributes" data-graph-form-target="addressesContainer">
    <!-- All changes stored in pendingChanges JSON field above -->
  </div>

  <!-- Buttons are in page header now -->
<% end %>